<!DOCTYPE html>
<html lang=en>
<head>
<meta charset=UTF-8>
<meta http-equiv=X-UA-Compatible content="IE=edge">
<meta name=viewport content="width=device-width, initial-scale=1.0">
<title>Project</title>
<link href="data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAD///8AiJQ3AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAERERERERERERERERERERERERERERERERERERERERERERERAREREREREREBEREREREREQERERERERERAAABEREREREBERAREREREQEREBERERERAREQEREREREAAAEREREREREREREREREREREREREREREREREREREREREREREREAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" rel="icon" type="image/x-icon" />
<style>*{font-family:Verdana,sans-serif;font-size:11px}body{margin:0 auto;padding:0 auto}thead th{color:white;text-shadow:2px 4px 3px rgba(0,0,0,0.3);background-color:#379488;position:sticky;z-index:10;top:0}table,th,td{border:solid 1px #c9d6d8;border-collapse:collapse;padding:5px 15px}table tr:hover td,table tr:hover textarea,table tr:hover select,table tr:hover input{background:#f8f8f8}textarea:focus,select:focus,input:focus{outline:0}tbody textarea,tbody select,tbody input{border:0;width:100%;resize:vertical}label{cursor:pointer;font-size:20px}.dropdown-filter-dropdown{color:black;text-shadow:none;position:absolute!important;bottom:0;right:0}.dropdown-filter-icon{border:0!important}.arrow-down{border:solid white!important;border-width:0 3px 3px 0!important;transform:rotate(45deg)!important}.hidden{display:none}table{width:3000px}.resizer{position:absolute;top:0;right:0;width:5px;cursor:col-resize;user-select:none}</style>
<script src=static/ResizableTable/ResizableTable.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/autosize.js/4.0.2/autosize.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin=anonymous></script>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha.6/css/bootstrap.min.css />
<script src=static/excel-bootstrap-table-filter/excel-bootstrap-table-filter-bundle.js></script>
<link rel=stylesheet href=static/excel-bootstrap-table-filter/excel-bootstrap-table-filter-style.css />
</head>
<body>
<div id=container></div>
</body>
<script>class CRUDtable{constructor(e){this.config=e}createTable(){let e=document.createElement("table");e.setAttribute("id",this.config.idTable);let t=document.createElement("thead");e.appendChild(t);let n=t.insertRow(-1);for(let e in this.config.heading){let t=document.createElement("th");t.innerHTML=this.config.heading[e],n.appendChild(t),e==this.config.colWithId&&t.setAttribute("style","display: none;")}let i=document.createElement("th"),l=document.createElement("label");l.setAttribute("onclick",'window.location.replace("/logout");'),l.setAttribute("title","logout"),l.innerHTML="‚û™",i.appendChild(l),n.appendChild(i),this.config.canCreateNew&&this.addLabel(this.createLabel("Create","New","‚úö","cursor:pointer; color:blue;"),n,i);let a=document.createElement("tbody");e.appendChild(a);for(let e in this.config.tableData){n=a.insertRow(-1);for(let t in this.config.column){let i=n.insertCell(-1);i.innerHTML=String(this.config.tableData[e][this.config.column[t]]).replaceAll("‚Å£","‚Å£ <br><br>"),t==this.config.colWithId&&i.setAttribute("style","display: none;")}let t=this.config.tableData[e][this.config.column[this.config.colWithId]],i=document.createElement("td");this.config.canUpdate&&(this.addLabel(this.createLabel("Cancel",t,"‚úñ","display:none;"),n,i),this.addLabel(this.createLabel("Save",t,"‚úî","display:none;"),n,i),this.addLabel(this.createLabel("Update",t,"‚úê"," color:orange;"),n,i)),this.config.canDelete&&this.addLabel(this.createLabel("Delete",t,"üóë"," color:red;"),n,i)}document.getElementById(this.config.idContainer).appendChild(e),this.renderExcelFilter(),createResizableTable(e)}createLabel(e,t,n,i){let l=document.createElement("label");return l.setAttribute("onclick",`${this.config.appName}.${e}(this)`),l.setAttribute("title",e+t),l.setAttribute("id",e+t),l.setAttribute("style",i),l.innerHTML=n,l}addLabel(e,t,n){t.appendChild(n),n.appendChild(e)}renderExcelFilter(){this.dischargeExcelFilter(),$(`#${this.config.idTable}`).excelTableFilter();for(let e=0;e<=this.config.column.length;e++)this.config.colWithFilter.includes(e)||$($("th")[e]).find(".dropdown-filter-dropdown").remove()}dischargeExcelFilter(){for(let e=1;e<=document.getElementsByTagName("tbody")[0].rows.length;e++)document.getElementsByTagName("tr")[e].removeAttribute("style")}getByIdAndSetStyle(e,t){document.getElementById(e).setAttribute("style",t)}getDataType(e,t,n){return new Function("td","col","id","typeArr",this.config.condition)(e,t,n,this.config.typeArr)}async Delete(e){let t=e.parentNode.parentNode,n=e.id.replace("Delete","");if("New"!=n){if(!confirm("–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ—ç–∫—Ç?"))return;try{let e=await fetch(this.config.fetchURL+n,{method:"DELETE"});if("200"!=e.status)throw new Error(await e.text())}catch(e){return alert(e)}}else"New"==n&&this.getByIdAndSetStyle("CreateNew","pointer-events: auto; color:blue;");t.remove(),this.renderExcelFilter()}Cancel(e){let t=e.parentNode.parentNode,n=e.id.replace("Cancel","");for(let e in this.config.column){var i=t.getElementsByTagName("td")[e],l=i.getElementsByClassName("hidden")[0];i.innerHTML=l.innerText}this.getByIdAndSetStyle("Cancel"+n,"display:none;"),this.getByIdAndSetStyle("Save"+n,"display:none;"),this.getByIdAndSetStyle("Update"+n,"display:block;   color:orange")}Update(e){let t=e.parentNode.parentNode,n=e.id.replace("Update","");this.createAddEditForm(t,n),this.getByIdAndSetStyle("Cancel"+n,"display:block;  color:red;"),this.getByIdAndSetStyle("Save"+n,"display:block;  color:green;"),this.getByIdAndSetStyle("Update"+n,"display:none;")}Create(e){let t=document.getElementsByTagName("tbody")[0],n=t.insertRow(-1);for(let e in this.config.column){let t=n.insertCell(-1);e==this.config.colWithId&&t.setAttribute("style","display: none;")}let i=document.createElement("td");this.addLabel(this.createLabel("Save","New","‚úî"," color:green;"),n,i),this.addLabel(this.createLabel("Delete","New","üóë"," color:red;"),n,i),this.createAddEditForm(n,"New"),t.lastChild.scrollIntoView({block:"center",behavior:"smooth"}),this.getByIdAndSetStyle("CreateNew","pointer-events: none; color:#b3b3b3;")}async Save(e){let t=e.parentNode.parentNode,n=e.id.replace("Save",""),i={};for(let e in this.config.column){let l=t.getElementsByTagName("td")[e],a=l.childNodes[0].innerText.trim(),r=l.childNodes[1].value.trim();switch(this.getDataType(t.getElementsByTagName("td"),e,n)){case"writeOnly":r=""==r?a:a+" "+(new Date).toJSON().substring(0,19).replace("T"," ")+" "+r+"‚Å£ ";break;case"reedOnly":r=""==a?" ":a;break;default:r=r}if(""==r){alert("all fields are compulsory"),i="";break}i[this.config.column[e]]=r}if(Object.keys(i).length>0){let e=[];for(let t in i)if(t!=this.config.nameColWithId||"New"!=n){let n=encodeURIComponent(t),l=encodeURIComponent(i[t]);e.push(n+"="+l)}if(e=e.join("&"),"New"!=n){try{let t=await fetch(this.config.fetchURL+n,{method:"PATCH",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e});if("200"!=t.status)throw new Error(await t.text())}catch(e){return alert(e)}this.getByIdAndSetStyle("Cancel"+n,"display:none;"),this.getByIdAndSetStyle("Save"+n,"display:none;"),this.getByIdAndSetStyle("Update"+n,"display:block;   color:orange")}else if("New"==n){try{let t=await fetch(this.config.fetchURL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e});if("200"!=t.status)throw new Error(await t.text());n=(await t.text()).replaceAll('"',"")}catch(e){return alert(e)}i[this.config.column[this.config.colWithId]]=n,t.lastChild.remove();let l=document.createElement("td");this.config.canUpdate&&(this.addLabel(this.createLabel("Cancel",n,"‚úñ","display:none;"),t,l),this.addLabel(this.createLabel("Save",n,"‚úî","display:none;"),t,l),this.addLabel(this.createLabel("Update",n,"‚úê"," color:orange;"),t,l)),this.config.canDelete&&this.addLabel(this.createLabel("Delete",n,"üóë"," color:red;"),t,l),this.getByIdAndSetStyle("CreateNew","pointer-events: auto; color:blue;")}let l=Object.values(i);for(let e in l){t.getElementsByTagName("td")[e].innerText=String(l[e]).replaceAll("‚Å£","‚Å£ \n\n")}this.renderExcelFilter()}}createAddEditForm(e,t){for(let n in this.config.column){let i,l,a=e.getElementsByTagName("td")[n];switch(this.getDataType(e.getElementsByTagName("td"),n,t)){case"date":let l=""!=a.innerText.trim()?a.innerText.trim():(new Date).toISOString().slice(0,10);(i=document.createElement("input")).setAttribute("type","date"),i.setAttribute("value",l);break;case"number":(i=document.createElement("input")).setAttribute("type","number"),i.setAttribute("value",a.innerText);break;case"percent":(i=document.createElement("input")).setAttribute("type","number"),i.setAttribute("min","0"),i.setAttribute("max","100"),i.setAttribute("value",a.innerText);break;case"email":(i=document.createElement("input")).setAttribute("type","email"),i.setAttribute("placeholder","mail@example.com"),i.setAttribute("value",a.innerText);break;case"tel":(i=document.createElement("input")).setAttribute("type","tel"),i.setAttribute("placeholder","+380661122333"),i.setAttribute("value",a.innerText);break;case"checkbox":(i=document.createElement("input")).setAttribute("type","checkbox"),"true"==a.innerText&&i.setAttribute("checked",a.innerText);break;case"reedOnly":(i=document.createElement("textarea")).setAttribute("readonly","true"),i.innerHTML=a.innerText;break;case"writeOnly":i=document.createElement("textarea");break;case"select":(i=document.createElement("select")).setAttribute("onchange",`${this.config.appName}.onchangeSelect(this.id)`),i.setAttribute("id",this.config.column[n]+t);for(let e in this.config[this.config.column[n]])i.innerHTML=i.innerHTML+'<option value="'+this.config[this.config.column[n]][e]+(a.innerText==this.config[this.config.column[n]][e]?'" selected>':'">')+this.config[this.config.column[n]][e]+"</option>";break;case"selectRelatedPrev":let r=e.getElementsByTagName("td")[n-1].getElementsByTagName("select")[0].id,o=this.config[this.config.column[n-1]].indexOf(document.getElementById(r).value);(i=document.createElement("select")).setAttribute("id",this.config.column[n]+t);for(let e in this.config[this.config.column[n]][o])i.innerHTML=i.innerHTML+'<option value="'+this.config[this.config.column[n]][o][e]+(a.innerText==this.config[this.config.column[n]][o][e]?'" selected>':'">')+this.config[this.config.column[n]][o][e]+"</option>";break;default:(i=document.createElement("textarea")).innerHTML=a.innerText}(l=document.createElement("div")).innerText=a.innerText,l.className="hidden",a.innerText="",a.appendChild(l),a.appendChild(i)}autosize(document.getElementsByTagName("textarea"))}onchangeSelect(e){for(let t in this.config.selectPair)if(e.includes(this.config.selectPair[t][0])){let n=this.config.selectPair[t][1],i=this.config.selectPair[t][0],l=e.replace(i,""),a=document.getElementById(e).value,r=this.config[i].indexOf(a),o=this.config[n][r],c=document.getElementById(n+l);for(t in c.options.length=0,o)c.innerHTML=c.innerHTML+'<option value="'+o[t]+'">'+o[t]+"</option>";break}}}let table=new CRUDtable(<%-config%>);table.createTable();</script>
</html>